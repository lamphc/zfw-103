{"version":3,"sources":["pages/Rent/Search/index.module.css","pages/Rent/Search/index.js"],"names":["module","exports","Search","state","searchTxt","tipsList","renderTips","map","item","onClick","selectComunity","key","community","className","styles","tip","communityName","search","val","trim","length","setState","timer","clearTimeout","setTimeout","a","getCommunity","cityId","status","data","console","log","getCurrCity","value","this","props","history","replace","pathname","id","name","root","placeholder","onChange","showCancelButton","onCancel","tips","Component"],"mappings":"8FACAA,EAAOC,QAAU,CAAC,KAAO,qBAAqB,KAAO,qBAAqB,UAAY,0BAA0B,KAAO,qBAAqB,IAAM,sB,uNCQ7HC,E,4MAEnBC,MAAQ,CAENC,UAAW,GAEXC,SAAU,I,EAuBZC,WAAa,WAGX,OAFqB,EAAKH,MAAlBE,SAEQE,KAAI,SAAAC,GAAI,OACtB,wBAAIC,QAAS,kBAAM,EAAKC,eAAeF,IAAOG,IAAKH,EAAKI,UAAWC,UAAWC,IAAOC,KAClFP,EAAKQ,mB,EAOZC,OAAS,SAACC,GAIR,GAAoB,IAFTA,EAAIC,OAENC,OAEP,OAAO,EAAKC,SAAS,CAAEjB,UAAW,GAAIC,SAAU,KAElD,EAAKgB,SAAS,CAAEjB,UAAWc,IAAO,WAEhC,EAAKI,OAASC,aAAa,EAAKD,OAChC,EAAKA,MAAQE,WAAU,sBAAC,gCAAAC,EAAA,sEAEOC,YAAaR,EAAK,EAAKS,QAF9B,gBAEhBC,EAFgB,EAEhBA,OAAQC,EAFQ,EAERA,KACdC,QAAQC,IAAIH,EAAQC,GACL,MAAXD,GACF,EAAKP,SAAS,CAAEhB,SAAUwB,IALN,2CAOrB,S,oMAhDmBG,c,gBAAhBC,E,EAAAA,MACRC,KAAKP,OAASM,E,2IAIAzB,GACdsB,QAAQC,IAAIvB,GACZ0B,KAAKC,MAAMC,QAAQC,QAAQ,CACzBC,SAAU,YAAaT,KAAM,CAE3BU,GAAI/B,EAAKI,UAET4B,KAAMhC,EAAKQ,mB,+BAwCN,IACDoB,EAAYF,KAAKC,MAAjBC,QACAhC,EAAc8B,KAAK/B,MAAnBC,UAER,OACE,yBAAKS,UAAWC,IAAO2B,MAErB,uBACEC,YAAY,mDACZT,MAAO7B,EACPuC,SAAUT,KAAKjB,OACf2B,kBAAkB,EAClBC,SAAU,kBAAMT,EAAQC,QAAQ,gBAIlC,wBAAIxB,UAAWC,IAAOgC,MAAOZ,KAAK5B,mB,GA/ENyC","file":"static/js/18.a3ba4eb9.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Search_root__1RO5f\",\"list\":\"Search_list__2aU3H\",\"noHistory\":\"Search_noHistory__1jsXM\",\"tips\":\"Search_tips__1_3KG\",\"tip\":\"Search_tip__V0T8K\"};","import React, { Component } from 'react'\r\n\r\nimport { SearchBar } from 'antd-mobile'\r\n\r\nimport { getCurrCity } from '../../../utils'\r\n\r\nimport styles from './index.module.css'\r\nimport { getCommunity } from '../../../utils/api/city'\r\n\r\nexport default class Search extends Component {\r\n\r\n  state = {\r\n    // 搜索框的值\r\n    searchTxt: '',\r\n    // 小区结果列表\r\n    tipsList: []\r\n  }\r\n\r\n  async componentDidMount () {\r\n    // 获取城市ID\r\n    const { value } = await getCurrCity()\r\n    this.cityId = value\r\n  }\r\n\r\n  // 选择小区 =》返回发布房源页面\r\n  selectComunity (item) {\r\n    console.log(item)\r\n    this.props.history.replace({\r\n      pathname: '/rent/add', data: {\r\n        // 小区ID\r\n        id: item.community,\r\n        // 小区名字\r\n        name: item.communityName\r\n      }\r\n    })\r\n  }\r\n\r\n  // 渲染搜索结果列表\r\n  renderTips = () => {\r\n    const { tipsList } = this.state\r\n\r\n    return tipsList.map(item => (\r\n      <li onClick={() => this.selectComunity(item)} key={item.community} className={styles.tip}>\r\n        {item.communityName}\r\n      </li>\r\n    ))\r\n  }\r\n  /**\r\n   * 根据关键词搜索小区列表（模糊匹配）\r\n   */\r\n  search = (val) => {\r\n    // console.log(val)\r\n    let _val = val.trim()\r\n    // 处理空的情况\r\n    if (_val.length === 0) {\r\n      // console.log(_val)\r\n      return this.setState({ searchTxt: '', tipsList: [] })\r\n    }\r\n    this.setState({ searchTxt: val }, () => {\r\n      // 函数防抖\r\n      this.timer && clearTimeout(this.timer)\r\n      this.timer = setTimeout(async () => {\r\n        // 根据关键词查询小区数据\r\n        let { status, data } = await getCommunity(val, this.cityId)\r\n        console.log(status, data)\r\n        if (status === 200) {\r\n          this.setState({ tipsList: data })\r\n        }\r\n      }, 600)\r\n    })\r\n  }\r\n\r\n  render () {\r\n    const { history } = this.props\r\n    const { searchTxt } = this.state\r\n\r\n    return (\r\n      <div className={styles.root}>\r\n        {/* 搜索框 */}\r\n        <SearchBar\r\n          placeholder=\"请输入小区或地址\"\r\n          value={searchTxt}\r\n          onChange={this.search}\r\n          showCancelButton={true}\r\n          onCancel={() => history.replace('/rent/add')}\r\n        />\r\n\r\n        {/* 搜索提示列表 */}\r\n        <ul className={styles.tips}>{this.renderTips()}</ul>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"],"sourceRoot":""}