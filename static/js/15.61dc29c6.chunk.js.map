{"version":3,"sources":["../node_modules/antd-mobile/lib/nav-bar/style/css.js","../node_modules/antd-mobile/lib/nav-bar/index.js","pages/CityList/index.jsx"],"names":["require","Object","defineProperty","exports","value","_extends3","_interopRequireDefault","_classCallCheck3","_createClass3","_possibleConstructorReturn3","_inherits3","_classnames2","React","obj","__esModule","newObj","key","prototype","hasOwnProperty","call","_interopRequireWildcard","__rest","s","e","t","p","indexOf","getOwnPropertySymbols","i","length","NavBar","_React$Component","this","__proto__","getPrototypeOf","apply","arguments","_a","props","prefixCls","className","children","mode","icon","onLeftClick","leftContent","rightContent","restProps","createElement","role","onClick","Component","defaultProps","module","CityList","state","cityList","cityIndex","activeIndex","handlerSelect","item","includes","label","sessionStorage","setItem","JSON","stringify","history","goBack","info","rowRenderer","index","style","isScrolling","isVisible","cateKey","cateList","formatCateKey","map","excueHeight","renderCityIndex","listRef","scrollToRow","onRowsRendered","overscanStartIndex","overscanStopIndex","startIndex","stopIndex","console","log","setState","getCityList","getCityData","status","data","formatCityData","getHotCity","hot","unshift","getCurrCity","curCity","forEach","firstKey","short","slice","push","keys","sort","isIndex","toUpperCase","type","height","width","ref","ele","scrollToAlignment","rowCount","rowHeight"],"mappings":"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","file":"static/js/15.61dc29c6.chunk.js","sourcesContent":["'use strict';\n\nrequire('../../style/css');\n\nrequire('./index.css');","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _react = require('react');\n\nvar React = _interopRequireWildcard(_react);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj['default'] = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar __rest = undefined && undefined.__rest || function (s, e) {\n    var t = {};\n    for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n    }if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n        if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n    }return t;\n};\n\nvar NavBar = function (_React$Component) {\n    (0, _inherits3['default'])(NavBar, _React$Component);\n\n    function NavBar() {\n        (0, _classCallCheck3['default'])(this, NavBar);\n        return (0, _possibleConstructorReturn3['default'])(this, (NavBar.__proto__ || Object.getPrototypeOf(NavBar)).apply(this, arguments));\n    }\n\n    (0, _createClass3['default'])(NavBar, [{\n        key: 'render',\n        value: function render() {\n            var _a = this.props,\n                prefixCls = _a.prefixCls,\n                className = _a.className,\n                children = _a.children,\n                mode = _a.mode,\n                icon = _a.icon,\n                onLeftClick = _a.onLeftClick,\n                leftContent = _a.leftContent,\n                rightContent = _a.rightContent,\n                restProps = __rest(_a, [\"prefixCls\", \"className\", \"children\", \"mode\", \"icon\", \"onLeftClick\", \"leftContent\", \"rightContent\"]);\n            return React.createElement(\n                'div',\n                (0, _extends3['default'])({}, restProps, { className: (0, _classnames2['default'])(className, prefixCls, prefixCls + '-' + mode) }),\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-left', role: 'button', onClick: onLeftClick },\n                    icon ?\n                    // tslint:disable-next-line:jsx-no-multiline-js\n                    React.createElement(\n                        'span',\n                        { className: prefixCls + '-left-icon', 'aria-hidden': 'true' },\n                        icon\n                    ) : null,\n                    leftContent\n                ),\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-title' },\n                    children\n                ),\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-right' },\n                    rightContent\n                )\n            );\n        }\n    }]);\n    return NavBar;\n}(React.Component);\n\nexports['default'] = NavBar;\n\nNavBar.defaultProps = {\n    prefixCls: 'am-navbar',\n    mode: 'dark',\n    onLeftClick: function onLeftClick() {}\n};\nmodule.exports = exports['default'];","import React, { Component } from 'react'\nimport { getCityData, getHotCity } from '../../utils/api/city'\nimport { getCurrCity } from '../../utils'\nimport { List, AutoSizer } from 'react-virtualized'\nimport './index.scss'\nimport { NavBar, Icon, Toast } from 'antd-mobile'\n\n// List data as an array of strings\n// 假数据\n// const list = Array.from(new Array(30)).map(() => Math.random() * 100)\n\nclass CityList extends Component {\n  state = {\n    // 列表归类的数据\n    cityList: {},\n    // 列表的归类项=》拼音首字母\n    cityIndex: [],\n    // 当前滚动到哪一行\n    activeIndex: 0,\n  }\n\n  componentDidMount() {\n    this.getCityList()\n  }\n\n  // 获取城市列表数据\n  async getCityList() {\n    const { status, data } = await getCityData()\n    // console.log(status, data)\n    if (status === 200) {\n      // 按照拼音首字母归类城市数据\n      const { cityList, cityIndex } = this.formatCityData(data)\n      // 热门城市数据\n      const { status, data: hot } = await getHotCity()\n      // console.log(status, hot)\n      if (status === 200) {\n        // 把热门城市数据加入到归类数据中\n        cityList['hot'] = hot\n        cityIndex.unshift('hot')\n      }\n      // 加入当前定位城市的数据\n      const curCity = await getCurrCity()\n      cityList['#'] = [curCity]\n      cityIndex.unshift('#')\n      // 响应式\n      this.setState({ cityList, cityIndex })\n      console.log('归类的数据：', cityList, cityIndex)\n    }\n  }\n\n  // 二次处理后台数据=》按照拼音首字母归类城市\n  /**\n   *\n   * @param {*} data 所有城市的数据\n   */\n  formatCityData(data) {\n    // 归类的数据\n    let cityList = {},\n      cityIndex\n    data.forEach((item) => {\n      // 获取当前item城市的拼音首字母\n      const firstKey = item.short.slice(0, 1)\n      if (!(firstKey in cityList)) {\n        // 当前类别不存在\n        cityList[firstKey] = [item]\n      } else {\n        // 存在=》push\n        cityList[firstKey].push(item)\n      }\n    })\n    cityIndex = Object.keys(cityList).sort()\n    return {\n      cityList,\n      cityIndex,\n    }\n  }\n\n  // 格式化列表渲染的类别\n  /**\n   *\n   * @param {*} cateKey 类别\n   * @param {*} isIndex 是否是索引导航渲染\n   */\n  formatCateKey(cateKey, isIndex) {\n    switch (cateKey) {\n      case '#':\n        return isIndex ? '当' : '当前城市'\n      case 'hot':\n        return isIndex ? '热' : '热门城市'\n      default:\n        return cateKey.toUpperCase()\n    }\n  }\n\n  // 城市选择和切换\n  /**\n   *\n   * @param {*} item 当前选择的城市\n   */\n  handlerSelect = (item) => {\n    // console.log(item)\n    // 只有北上广深有数据=》可以做城市切换\n    let hasData = ['北京', '上海', '广州', '深圳']\n    if (hasData.includes(item.label)) {\n      // 切换城市\n      // 覆盖定位信息=》变成用户选择的城市\n      sessionStorage.setItem('CURR_CITY', JSON.stringify(item))\n      this.props.history.goBack()\n    } else {\n      Toast.info('当前城市暂无房源数据！')\n    }\n  }\n\n  // 列表渲染的项item模版\n  rowRenderer = ({\n    key, // Unique key within array of rows\n    index, // Index of row within collection\n    isScrolling, // The List is currently being scrolled\n    isVisible, // This row is visible within the List (eg it is not an overscanned row)\n    style, // Style object to be applied to row (to position it)\n  }) => {\n    // const data = list[index]\n    // 获取归类项和该项数据\n    const { cityList, cityIndex } = this.state\n    // 类别\n    const cateKey = cityIndex[index]\n    // 当前类别下的数据=》城市=》多个或一个\n    const cateList = cityList[cateKey]\n\n    return (\n      <div key={key} style={style} className=\"city-item\">\n        {/* 类别 */}\n        <div className=\"title\">{this.formatCateKey(cateKey)}</div>\n        {/* 类别下数据=》城市 => 列表渲染 */}\n        {cateList.map((item) => (\n          <div\n            onClick={() => {\n              this.handlerSelect(item)\n            }}\n            key={item.value}\n            className=\"name\">\n            {item.label}\n          </div>\n        ))}\n      </div>\n    )\n  }\n\n  // 动态计算列表行的高度\n  /**\n   *\n   * @param {*} index 列表项的索引\n   */\n  excueHeight = ({ index }) => {\n    // 获取归类项和该项数据\n    const { cityList, cityIndex } = this.state\n    // 类别\n    const cateKey = cityIndex[index]\n    // 当前类别下的数据=》城市=》多个或一个\n    const cateList = cityList[cateKey]\n\n    return 36 + 50 * cateList.length\n  }\n\n  // 渲染右侧索引\n  renderCityIndex = () => {\n    const { cityIndex, activeIndex } = this.state\n    return cityIndex.map((item, index) => {\n      return (\n        <li\n          onClick={() => {\n            // console.log(this.listRef)\n            this.listRef.scrollToRow(index)\n            // 高亮\n            // this.setState({ activeIndex: index })\n          }}\n          key={item}\n          className=\"city-index-item\">\n          <span className={activeIndex === index ? 'index-active' : ''}>\n            {this.formatCateKey(item, true)}\n          </span>\n        </li>\n      )\n    })\n  }\n  // List每次滚动渲染执行这个钩子函数\n  /**\n   *\n   * @param {*} param0\n   */\n  onRowsRendered = ({\n    // 某一屏数据开始和结束的索引（带下一屏幕多余的数据）\n    overscanStartIndex,\n    overscanStopIndex,\n    // 某一屏数据开始和结束的索引（可见区域）\n    startIndex,\n    stopIndex,\n  }) => {\n    // console.log(overscanStartIndex, overscanStopIndex, startIndex, stopIndex)\n\n    // 滚动到哪一行就高亮显示\n    if (this.state.activeIndex !== startIndex) {\n      console.log('当前滚动到哪一行：', startIndex)\n      this.setState({ activeIndex: startIndex })\n    }\n  }\n\n  // 模版\n  render() {\n    return (\n      <div className=\"cityList\">\n        {/* 头部导航栏 */}\n        <NavBar\n          mode=\"dark\"\n          icon={<Icon type=\"left\" />}\n          onLeftClick={() => this.props.history.goBack()}>\n          城市选择\n        </NavBar>\n        {/* 城市选择列表 */}\n        <AutoSizer>\n          {({ height, width }) => (\n            <List\n              // 获取组件实例=》ref对象\n              ref={(ele) => (this.listRef = ele)}\n              // 滚动对齐方式 =>顶部对齐\n              scrollToAlignment=\"start\"\n              // 每次滚动渲染执行\n              onRowsRendered={this.onRowsRendered}\n              // 控制列表宽高\n              width={width}\n              height={height}\n              // 列表数据的总长度\n              rowCount={this.state.cityIndex.length}\n              // 列表项的高度 => 动态设置高度\n              rowHeight={this.excueHeight}\n              // 选染列表项目\n              rowRenderer={this.rowRenderer}\n            />\n          )}\n        </AutoSizer>\n        {/* 右侧索引列表 */}\n        <ul className=\"city-index\">{this.renderCityIndex()}</ul>\n      </div>\n    )\n  }\n}\n\nexport default CityList\n"],"sourceRoot":""}